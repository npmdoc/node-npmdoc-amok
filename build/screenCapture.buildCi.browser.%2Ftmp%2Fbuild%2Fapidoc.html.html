<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="http://amokjs.com">amok (v1.1.3)</a>
</h1>
<h4>Live editing, testing and debugging for JavaScript</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.amok">module amok</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.amok.browser">
            function <span class="apidocSignatureSpan">amok.</span>browser
            <span class="apidocSignatureSpan">(port, command, args, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.amok.compiler">
            function <span class="apidocSignatureSpan">amok.</span>compiler
            <span class="apidocSignatureSpan">(command, args, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.amok.createRunner">
            function <span class="apidocSignatureSpan">amok.</span>createRunner
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.amok.hotpatch">
            function <span class="apidocSignatureSpan">amok.</span>hotpatch
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.amok.multiplexer">
            function <span class="apidocSignatureSpan">amok.</span>multiplexer
            <span class="apidocSignatureSpan">(port, host, debugPort, debugHost)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.amok.print">
            function <span class="apidocSignatureSpan">amok.</span>print
            <span class="apidocSignatureSpan">(output)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.amok.repl">
            function <span class="apidocSignatureSpan">amok.</span>repl
            <span class="apidocSignatureSpan">(input, output, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.amok.server">
            function <span class="apidocSignatureSpan">amok.</span>server
            <span class="apidocSignatureSpan">(port, host)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.amok.watch">
            function <span class="apidocSignatureSpan">amok.</span>watch
            <span class="apidocSignatureSpan">(glob)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">amok.</span>_eventsCount</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">amok.</span>_events</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">amok.</span>client</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">amok.</span>domain</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">amok.</span>plugins</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">amok.</span>settings</span>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.amok" id="apidoc.module.amok">module amok</a></h1>


    <h2>
        <a href="#apidoc.element.amok.browser" id="apidoc.element.amok.browser">
        function <span class="apidocSignatureSpan">amok.</span>browser
        <span class="apidocSignatureSpan">(port, command, args, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function plugin(port, command, args, options) {
  if (typeof args === 'undefined') {
    args = [];
  } else {
    args = args.slice(0);
  }

  return function browser(client, runner, done) {
    var server = net.createServer();

    server.once('error', function(error) {
      debug('server error', error);
      done(error);
    });

    server.once('listening', function() {
      debug('server listening');

      server.once('close', function() {
        debug('server close');

        var url = runner.get('url');

        // TODO, move into browser_process.createProfile, deleting the first run file
        // should be equivilent of providing these options, and be compatible with how firefox does it.
        args.unshift('--no-first-run', '--no-default-browser-check');
        var dirname = temp.path(command);
        args.unshift.apply(args, web.options(command, {
          profile: dirname,
          url: url,
          debug: port,
        }));

        debug('spawn %s %s', command, args.join(' '));
        web.spawn(command, args, options, function (error, browser) {
          if (error) {
            debug('bail %s', error.description);
            return done(error);
          }

          runner.once('close', function kill() {
            debug('kill process');
            browser.kill('SIGTERM');
          });

          debug('find %s', url);
          setTimeout(function find(retry) {
            rdbg.get(port, 'localhost', function (error, targets) {
              if (error) {
                targets = [];
              }

              var matches = targets.filter(function (target) {
                return url === target.url;
              });

              if (matches.length &gt; 0) {
                debug('ready');
                return done();
              } else if (retry) {
                return setTimeout(find, 1000, retry--);
              }

              if (error === undefined) {
                error = new Error('Cannot find browser tab \'' + url + '\'');
              }

              debug('find error', error);
              done(error);
            });
          }, 1000, 120);
        });
      });

      debug('close server');
      server.close();
    });

    debug('starting server on port', port);
    server.listen(port);
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}

if (program.hot) {
  amok.use(amok.hotpatch());
}

if (program.browser) {
  amok.use(amok.<span class="apidocCodeKeywordSpan">browser</span>(program.debugPort, program.browser.command, program.browser.args
, {
    stdio: ['ignore', process.stderr, process.stderr]
  }));
}

if (program.interactive) {
  amok.use(amok.repl(process.stdin, process.stdout));
} else {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.amok.compiler" id="apidoc.element.amok.compiler">
        function <span class="apidocSignatureSpan">amok.</span>compiler
        <span class="apidocSignatureSpan">(command, args, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function plugin(command, args, options) {
  if (typeof args == 'undefined') {
    args = [];
  } else {
    args = args.slice(0);
  }

  return function compiler(client, runner, done) {
    var entry = args.filter(function (arg) {
      return arg.match(/(.js|.ts|.coffee)$/);
    })[0];

    var dirname = temp.mkdirSync(command);
    var pathname = path.normalize(entry);
    var basename = path.basename(pathname);
    var filename = path.join(dirname, basename).replace(/\.[^\.]+$/, '.js');

    var scripts = {};
    scripts[pathname] = filename;
    runner.set('scripts', scripts);

    args.unshift.apply(args, script.options(command, {
      outfile: filename,
      watch: true,
    }));

    debug('spawn %s %s', command, args.join(' '));
    script.spawn(command, args, options, function (error, compiler) {
      if (error) {
        debug('bail %s', error.description);
        return done(error);
      }

      runner.once('close', function kill() {
        debug('kill');
        compiler.kill('SIGTERM');
      });

      debug('wait %s', filename);
      process.nextTick(function wait() {
        fs.stat(filename, function (error, stat) {
          if (error || stat.size === 0) {
            return process.nextTick(wait);
          }

          setTimeout(function () {
            debug('ready');
            done();
          }, 250);
        });
      });
    });
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

  amok.use(amok.server(program.httpPort, program.httpHost));
} else {
  program.help();
}

if (program.compiler) {
  amok.use(amok.<span class="apidocCodeKeywordSpan">compiler</span>(program.compiler, program.args, {
    stdio: ['ignore', process.stderr, process.stderr]
  }));
}

if (program.watch) {
  amok.use(amok.watch(program.watch));
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.amok.createRunner" id="apidoc.element.amok.createRunner">
        function <span class="apidocSignatureSpan">amok.</span>createRunner
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function createRunner() {
  return new Runner();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.amok.hotpatch" id="apidoc.element.amok.hotpatch">
        function <span class="apidocSignatureSpan">amok.</span>hotpatch
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function plugin() {
  return function hotpatch(client, runner, done) {
    var cwd = runner.get('cwd');
    if (cwd) {
      cwd = path.resolve(cwd);
    } else {
      cwd = process.cwd();
    }

    var scripts = {};
    var watchers = {};

    client.on('close', function () {
      debug('close');
      scripts = {};

      Object.keys(watchers).forEach(function (key) {
        watchers[key].close();
      });

      watchers = {};
    });

    client.on('connect', function () {
      debug('connect');

      client.debugger.on('clear', function () {
        debug('clear');
        scripts = {};

        Object.keys(watchers).forEach(function (key) {
          watchers[key].close();
        });

        watchers = {};
      });

      client.debugger.on('scriptParse', function (script) {
        debug('parse %s', util.inspect(script));

        var uri = url.parse(script.url);
        var filename = null;
        var sources = runner.get('scripts') || {};

        if (uri.protocol === 'file:') {
          filename = path.normalize(uri.pathname);
          if (filename.match(/^\\[a-zA-Z]:\\/)) {
            filename = filename.slice(1);
          }
        } else if (uri.protocol === 'http:') {
          filename = uri.pathname.slice(1);
          if (sources[path.normalize(filename)]) {
            filename = path.resolve(sources[path.normalize(filename)]);
          } else {
            filename = path.resolve(cwd, filename);
          }
        }

        if (!filename) {
          return;
        }

        scripts[filename] = script;
        if (watchers[filename]) {
          return;
        }

        var dirname = path.dirname(filename);

        debug('watch directory %s', dirname);
        var watcher = fs.watch(dirname);
        watchers[dirname] = watcher;

        var streams = {};
        watcher.on('change', function (event, filename) {
          if (!filename) {
            return;
          }

          filename = path.resolve(dirname, filename);

          var script = scripts[filename];
          if (!script) {
            return;
          }

          debug(event, filename);
          if (streams[filename]) {
            return;
          }

          var source = '';
          var stream = fs.createReadStream(filename);
          streams[filename] = stream;

          stream.setEncoding('utf-8');
          stream.on('data', function(chunk) {
            source += chunk;
          });

          stream.on('end', function() {
            streams[filename] = null;

            if (source.length === 0) {
              return;
            }

            debug('patch script %s (%d bytes) ', script.url, source.length);
            client.debugger.setScriptSource(script, source, function (error, result) {
              if (error) {
                debug('set source error %s', util.inspect(error));
                return client.emit('error', error);
              }

              var detail = JSON.stringify({
                detail: {
                  filename: path.relative(cwd, filename),
                  source: source,
                }
              });

              var cmd = 'var event = new CustomEvent(\'patch\',' +
              detail + ');\nwindow.dispatchEvent(event);';

              debug('evaluate patch event');
              client.runtime.evaluate(cmd, function (error) {
                if (error) {
                  debug('evaluate error %s', util.inspect(error));
                  return client.emit('error', error);
                }
              });
            });
          });
        });
      });

      client.debugger.enable(function (error) {
        if (error) {
          return client.emit('error', error);
        }

        debug('debugger');
      });

      client.runtime.enable(function (error) {
        if (error) {
          return client.emit('error', error);
        }

        debug('runtime');
      });
    });

    debug('done');
    done();
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}

if (program.watch) {
  amok.use(amok.watch(program.watch));
}

if (program.hot) {
  amok.use(amok.<span class="apidocCodeKeywordSpan">hotpatch</span>());
}

if (program.browser) {
  amok.use(amok.browser(program.debugPort, program.browser.command, program.browser.args, {
    stdio: ['ignore', process.stderr, process.stderr]
  }));
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.amok.multiplexer" id="apidoc.element.amok.multiplexer">
        function <span class="apidocSignatureSpan">amok.</span>multiplexer
        <span class="apidocSignatureSpan">(port, host, debugPort, debugHost)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function plugin(port, host, debugPort, debugHost) {
  return function multiplexer(client, runner, done) {
    // TODO The meat of this implementation should probaly go into an rdbg adapter module.
    var upstream = {};

    var server = http.createServer();
    server.on('request', function (request, response) {
      var upstreamRequest = http.request({
        port: debugPort,
        hostname: debugHost,
        path: request.url,
      });

      if (request.url == '/json' || request.url === '/json/list') {
        upstreamRequest.on('response', function (upstreamResponse) {
          var data = '';

          upstreamResponse.on('data', function (chunk) {
            data += chunk;
          });

          upstreamResponse.on('end', function () {
            var targets = JSON.parse(data);
            targets.forEach(function (target) {
              var webSocketDebuggerUrl = Object.keys(upstream).filter(function(key) {
                return key.search(target.id);
              })[0];

              if (target.webSocketDebuggerUrl || webSocketDebuggerUrl) {
                target.webSocketDebuggerUrl = url.format({
                  protocol: 'ws',
                  slashes: true,
                  port: port,
                  hostname: host,
                  pathname: '/devtools/page/' + target.id,
                });
              }

              if (target.webSocketDebuggerUrl) {
                target.devtoolsFrontendUrl = util.format('/devtools/inspector.html?ws=%s', target.webSocketDebuggerUrl.slice(5));
              }
            });

            response.end(JSON.stringify(targets, undefined, 2));
          });
        });

        upstreamRequest.end();
      } else {
        upstreamRequest.on('response', function (upstreamResponse) {
          upstreamResponse.pipe(response);
        });

        upstreamRequest.end();
      }
    });

    var socket = ws.createServer({ server: server });
    socket.on('connection', function (connection) {
      var upstreamUrl = url.format({
        protocol: 'ws',
        slashes: true,
        hostname: debugHost,
        port: debugPort,
        pathname: connection.upgradeReq.url,
      });

      if (!upstream[upstreamUrl]) {
        var upstreamConnection = ws.createConnection(upstreamUrl);
        upstream[upstreamUrl] = {
          localId: 0,
          connection: upstreamConnection,
          connections: [connection],
          mappings: {},
          notifications: [],
        };

        upstreamConnection.on('close', function() {
          upstream[upstreamUrl].connections.forEach(function(connection) {
            connection.close();
          });

          delete upstream[upstreamUrl];
        });

        upstreamConnection.on('message', function (data) {
          var message = JSON.parse(data);

          if (message.id === undefined) {
            upstream[upstreamUrl].notifications.push(JSON.parse(data));
            upstream[upstreamUrl].connections.forEach(function (connection) {
              connection.send(data);
            });
          } else {
            var mappings = upstream[upstreamUrl].mappings[message.id];
            message.id = mappings.id;
            mappings.connection.send(JSON.stringify(message));
          }
        });
      } else {
        upstream[upstreamUrl].connections.push(connection);
      }

      connection.notifications = upstream[upstreamUrl].notifications.slice(0);
      connection.upstream = upstream[upstreamUrl];

      connection.on('message', function (data) {
        var upstream = connection.upstream;

        var message = JSON.parse(data);

        if (message.method &amp;&amp; message.method.match(/enable$/)) {
          var domain = message.method.split('.')[0];

          connection.notifications = connection.notifications.filter(function (notification) {
            if (notification.method.search(domain)) {
              connection.send(JSON.stringify(notification));
              return false;
            }

            return true;
          });
        }

        var local = upstream.localId++; ...</pre></li>
    <li>example usage<pre class="apidocCodePre">...

amok.on('connect', function () {
  amok.client.on('error', function (error) {
    process.stderr.write(error.message + '\n');
  });
});

amok.use(amok.<span class="apidocCodeKeywordSpan">multiplexer</span>(program.port, program.host, program.debugPort, program.debugHost
));

amok.connect(program.port, program.host);

process.on('SIGTERM', function () {
  process.exit(0);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.amok.print" id="apidoc.element.amok.print">
        function <span class="apidocSignatureSpan">amok.</span>print
        <span class="apidocSignatureSpan">(output)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function plugin(output) {
  return function print(client, runner, done) {
    client.console.on('data', function (message) {
      output.write(message.text + '\n');
    });

    client.on('connect', function () {
      client.console.enable(function (error) {
        if (error) {
          return client.emit('error', error);
        }
        debug('console');
      });
    });

    debug('ready');
    done();
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    stdio: ['ignore', process.stderr, process.stderr]
  }));
}

if (program.interactive) {
  amok.use(amok.repl(process.stdin, process.stdout));
} else {
  amok.use(amok.<span class="apidocCodeKeywordSpan">print</span>(process.stdout));
}

amok.on('connect', function () {
  amok.client.on('error', function (error) {
    process.stderr.write(error.message + '\n');
  });
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.amok.repl" id="apidoc.element.amok.repl">
        function <span class="apidocSignatureSpan">amok.</span>repl
        <span class="apidocSignatureSpan">(input, output, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function plugin(input, output, options) {
  if (typeof options === 'undefined') {
    options = {};
  }

  return function repl(client, runner, done) {
    debug('start');
    var repl = repls.start({
      input: input,
      output: output,
      useColors: options.useColors
    });

    repl.on('exit', function() {
      runner.close();
    });

    repl.eval = function (cmd, context, filename, callback) {
      client.runtime.evaluate(cmd, function (error, output) {
        if (error) {
          return callback(error);
        }

        var result = output.result;
        if (result.type === 'string') {
          return callback(null, result.value);
        } else if (result.type === 'function') {
          var fn = new Function('return ' + result.description.replace('[native code]', '/* remote code */'));
          return callback(null, fn());
        } else if (result.subtype === 'error') {
          return callback(result.description);
        } else if (result.type === 'object') {
          var obj = {};
          return callback(null, obj);
        } else {
          return callback(null, eval(result.value));
        }
      });
    };

    repl.complete = function (line, callback) {
      callback([], line);
    };

    client.console.on('data', function (message) {
      repl.output.clearLine();
      repl.output.cursorTo(0);
      repl.output.write(message.text + '\n');
      repl.prompt(true);
    });

    client.on('connect', function () {
      client.console.enable(function (error) {
        if (error) {
          return client.emit('error', error);
        }

        debug('console enabled');
      });

      client.runtime.enable(function (error) {
        if (error) {
          return client.emit('error');
        }

        debug('runtime');
      });
    });

    debug('ready');
    done();
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
if (program.browser) {
amok.use(amok.browser(program.debugPort, program.browser.command, program.browser.args, {
  stdio: ['ignore', process.stderr, process.stderr]
}));
}

if (program.interactive) {
amok.use(amok.<span class="apidocCodeKeywordSpan">repl</span>(process.stdin, process.stdout));
} else {
amok.use(amok.print(process.stdout));
}

amok.on('connect', function () {
amok.client.on('error', function (error) {
  process.stderr.write(error.message + '\n');
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.amok.server" id="apidoc.element.amok.server">
        function <span class="apidocSignatureSpan">amok.</span>server
        <span class="apidocSignatureSpan">(port, host)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function plugin(port, host) {
  return function server(client, runner, done) {
    var server = http.createServer();

    server.once('error', function (error) {
      done(error);
    });

    server.once('listening', function ready() {
      runner.set('url', url.format({
        protocol: 'http',
        port: port,
        hostname: host,
        pathname: '/'
      }));

      debug('ready');
      done();
    });

    runner.once('close', function close() {
      debug('close');
      server.close();
    });

    server.on('request', function handle(request, response) {
      debug('handle %s', request.url);

      var pathname = url.parse(request.url).pathname;
      if (pathname === '/') {
        pathname = '/index.html';
      }

      var scripts = runner.get('scripts') || {};
      var cwd = runner.get('cwd') || process.cwd();
      var filename = scripts[path.normalize(pathname.slice(1))] || path.normalize(pathname.slice(1));

      if (!path.isAbsolute(filename)) {
        filename = path.join(cwd, filename);
      }

      fs.stat(filename, function (error, stat) {
        response.setHeader('content-type', mime.lookup(filename));

        if (error) {
          if (pathname === '/index.html') {
            debug('generate index.html');

            response.write('&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;');
            response.write('&lt;title&gt;' + path.basename(cwd) + '&lt;/title&gt;');
            response.write('&lt;/head&gt;&lt;body&gt;');

            if (scripts) {
              Object.keys(scripts).forEach(function (src) {
                response.write('&lt;script src="' + src + '"&gt;&lt;/script&gt;');
              });
            }

            return response.end('&lt;/body&gt;&lt;/html&gt;');
          } else if (pathname === '/favicon.ico') {
            debug('generate favicon.ico');
            return response.end();
          } else {
            debug('404 %s', pathname);
            response.statusCode = 404;
            return response.end('404');
          }
        }

        if (stat.isFile()) {
          debug('stream %s', filename);
          fs.createReadStream(filename).pipe(response);
        } else {
          debug('403 %s', pathname);
          response.statusCode = 403;
          return response.end('403');
        }
      });
    });

    server.listen(port, host);
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
amok.set('url', program.url);
} else if (program.scripts.length &gt; 0) {
amok.set('scripts', program.scripts.reduce(function (object, value, key) {
  object[value] = value;
  return object;
}, {}));

amok.use(amok.<span class="apidocCodeKeywordSpan">server</span>(program.httpPort, program.httpHost));
} else {
program.help();
}

if (program.compiler) {
amok.use(amok.compiler(program.compiler, program.args, {
  stdio: ['ignore', process.stderr, process.stderr]
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.amok.watch" id="apidoc.element.amok.watch">
        function <span class="apidocSignatureSpan">amok.</span>watch
        <span class="apidocSignatureSpan">(glob)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function plugin(glob) {
  return function watch(client, runner, done) {
    var cwd = runner.get('cwd');
    if (cwd) {
      cwd = path.resolve(cwd);
    } else {
      cwd = process.cwd();
    }

    debug('watch %s', glob);

    var watcher = chokidar.watch(glob, {
      ignoreInitial: true,
      cwd: cwd,
    });

    watcher.once('error', function error(error) {
      debug('error %s', util.inspect(error));
      done(error);
    });

    watcher.once('ready', function ready() {
      debug('ready');
      done();
    });

    runner.once('close', function close() {
      debug('close');
      watcher.close();
    });

    client.on('close', function () {
      watcher.removeAllListeners('all');
    });

    client.on('connect', function () {
      watcher.on('all', function emit(event, filename) {
        debug('%s %s', event, filename);

        var detail = JSON.stringify({
          detail: {
            filename: url.resolve('/', filename).slice(1)
          }
        });

        var cmd = 'var event = new CustomEvent(\'' + event + '\',' +
          detail + ');\nwindow.dispatchEvent(event);';

        client.runtime.evaluate(cmd, function (error, result) {
          if (error) {
            debug('error %s', error.description);
            return client.emit('error', error);
          }
        });
      });

      client.runtime.enable(function (error) {
        if (error) {
          return client.emit('error', error);
        }

        debug('runtime');
      });
    });
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
if (program.compiler) {
  amok.use(amok.compiler(program.compiler, program.args, {
    stdio: ['ignore', process.stderr, process.stderr]
  }));
}

if (program.watch) {
  amok.use(amok.<span class="apidocCodeKeywordSpan">watch</span>(program.watch));
}

if (program.hot) {
  amok.use(amok.hotpatch());
}

if (program.browser) {
...</pre></li>
    </ul>














</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>